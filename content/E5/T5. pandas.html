
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5 Pandas &#8212; Scientific Programming in Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/E5/T5. pandas';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="7 Object Oriented Programming" href="../E7/T7.%20OOP_python.html" />
    <link rel="prev" title="4. Exploring Scipy and other python packages" href="../E4/T4.%20scipyetc.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Scientific Programming in Python - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="Scientific Programming in Python - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Scientific Programming in Python Course - University of Nottingham (PHYS4038 & AS1)
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Information about the course</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../info_course/overview.html">Overview of the course</a></li>



<li class="toctree-l1"><a class="reference internal" href="../info_course/inclass_test.html">The in-class test</a></li>
<li class="toctree-l1"><a class="reference internal" href="../info_course/projects.html">Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../info_course/starter_projects.html">Starter materials / examples for projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../info_course/assessment.html">Assessment details and criteria for PGT students</a></li>
<li class="toctree-l1"><a class="reference internal" href="../info_course/integrity.html">Academic integrity</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Teaching Resources</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../E1/T1.%20python_setup.html">1. Python getting setup</a></li>

<li class="toctree-l1"><a class="reference internal" href="../E2/T2.%20python_basics.html">2 Introduction to python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../E3/T3.%20numpy_matplotlib.html">3 Scientific Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../E4/T4.%20scipyetc.html">4. Exploring Scipy and other python packages</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">5 Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../E7/T7.%20OOP_python.html">7 Object Oriented Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../E8/T8.%20learngit.html">8 Git and Github</a></li>

<li class="toctree-l1"><a class="reference internal" href="../E9/T9.%20testing_debugging_refactoring.html">9 Testing, Debugging and Refactoring</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/content/E5/T5. pandas.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>5 Pandas</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#series-and-dataframes">5.1 Series and Dataframes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-series-and-dataframes">5.1.1 Creating Series and DataFrames</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selecting-data-in-a-dataframe">5.1.2 Selecting Data in a DataFrame</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modifying-dataframes">5.1.3 Modifying DataFrames</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-input-and-output">5.2 Data input and output</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-data-from-files">5.2.1 Reading Data from Files</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#writing-data-to-files">5.2.2 Writing Data to files</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#returning-vs-inplace">5.3.1 Returning vs inplace</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-cleaning">5.3.2 Data Cleaning</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#copy-vs-views">5.3.3 Copy vs Views</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aggregation-and-grouping">5.4 Aggregation and grouping</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#timeseries-data">5.5 TimeSeries Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#joining-dataframes">5.6 Joining DataFrames</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#concatenation">5.6.1 Concatenation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#merging">5.6.2 Merging</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#speeding-things-up-in-pandas">5.7 Speeding things up in Pandas</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="pandas">
<h1>5 Pandas<a class="headerlink" href="#pandas" title="Link to this heading">#</a></h1>
<p>When working with large complex datasets it is often useful to be able to manipulate the data in a variety of ways. Numpy is great for doing calculations on arrays but it is not so good at manipulating data.</p>
<section id="series-and-dataframes">
<h2>5.1 Series and Dataframes<a class="headerlink" href="#series-and-dataframes" title="Link to this heading">#</a></h2>
<p>Pandas is a python package which builds on top of Numpy. It is designed to allow fast and efficient manipulation of data structures. It introduces two basic datatypes:</p>
<ol class="arabic simple">
<li><p>A Series -   a 1d array</p></li>
<li><p>A Dataframe  -   a 2d array</p></li>
</ol>
<p>These datatypes are built on top of Numpy but the main difference is that all the data is not just indexed by sequential numbers but has labels. This will become clearer as we study them.</p>
<section id="creating-series-and-dataframes">
<h3>5.1.1 Creating Series and DataFrames<a class="headerlink" href="#creating-series-and-dataframes" title="Link to this heading">#</a></h3>
<p>We can create both Series and DataFrames from other datatypes like lists, numpy arrays or dictionaries. See example below or the docs for full details (<a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.html">Series</a> and <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html">DataFrames</a>)</p>
<p><em>Be aware that when Pandas switched to v2 certain functions etc were deprecated (ie no longer available). There are lots of examples on the internet still using old methods which won’t work. Check the docs if you are unsure</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1">#Create a series</span>
<span class="n">my_data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">11</span><span class="p">]</span>
<span class="n">data_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">my_data</span><span class="p">)</span>

<span class="c1">#A dataframe</span>
<span class="n">other_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;age&#39;</span><span class="p">:[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span><span class="s1">&#39;name&#39;</span><span class="p">:[</span><span class="s1">&#39;Jane&#39;</span><span class="p">,</span><span class="s1">&#39;Tom&#39;</span><span class="p">,</span><span class="s1">&#39;Lucy&#39;</span><span class="p">,</span><span class="s1">&#39;Bob&#39;</span><span class="p">],</span> <span class="s1">&#39;gender&#39;</span><span class="p">:[</span><span class="s1">&#39;Female&#39;</span><span class="p">,</span> <span class="s1">&#39;Male&#39;</span><span class="p">,</span><span class="s1">&#39;Female&#39;</span><span class="p">,</span> <span class="s1">&#39;Male&#39;</span><span class="p">]}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">other_data</span><span class="p">)</span>   <span class="c1"># You&#39;ll see that people often write the dataframe variable as df. </span>

<span class="nb">print</span><span class="p">(</span><span class="n">data_series</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0     3
1     5
2     7
3     9
4    11
dtype: int64
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>name</th>
      <th>gender</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>20</td>
      <td>Jane</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>1</th>
      <td>24</td>
      <td>Tom</td>
      <td>Male</td>
    </tr>
    <tr>
      <th>2</th>
      <td>24</td>
      <td>Lucy</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>3</th>
      <td>50</td>
      <td>Bob</td>
      <td>Male</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>As well as the values we put in, there is an additional column to the left which is called the index. We didn’t specify index labels, so pandas has created values which are just sequential numbers. However, part of the power of Pandas is we can specify a meaningful index when we create it or <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.set_index.html"> set index to a column </a> later.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">other_data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">])</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>name</th>
      <th>gender</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>20</td>
      <td>Jane</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>c</th>
      <td>24</td>
      <td>Tom</td>
      <td>Male</td>
    </tr>
    <tr>
      <th>e</th>
      <td>24</td>
      <td>Lucy</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>g</th>
      <td>50</td>
      <td>Bob</td>
      <td>Male</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="selecting-data-in-a-dataframe">
<h3>5.1.2 Selecting Data in a DataFrame<a class="headerlink" href="#selecting-data-in-a-dataframe" title="Link to this heading">#</a></h3>
<p>This labelled index provides us with two ways of referring to the row. We can index by location (<code class="docutils literal notranslate"><span class="pre">df.iloc[row,</span> <span class="pre">col]</span></code>) in a manner similar to numpy. ie the first row is row 0, the second is row 1. The columns can also be indexed as 0 and 1. However, we can also index by label (<code class="docutils literal notranslate"><span class="pre">df.loc[row_label,</span> <span class="pre">col_label]</span></code>). It is possible that more than one row may have the same label and this second method will select both.</p>
<p><em>N.B. In Pandas wherever you want to select multiple values you need to add an extra pair of brackets.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Indexing by location&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1">#   Get the first row</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span> <span class="c1">#   Get the first column. N.B double brackets</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span> <span class="c1">#   Get the second and first row&#39;s values in first and second column. N.B double brackets</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#   Get item at first row and second column</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Indexing by label&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">])</span>  <span class="c1">#   Get row labelled a</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="c1">#   Get column labelled name  --&gt; returns a Series</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;age&#39;</span><span class="p">]])</span>   <span class="c1">#   Get columns labelled name and age --&gt; returns a Dataframe. </span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>   <span class="c1">#   value with row labelled a and column labelled name</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Indexing by location
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>age           20
name        Jane
gender    Female
Name: a, dtype: object
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>a    20
c    24
e    24
g    50
Name: age, dtype: int64
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>c</th>
      <td>24</td>
      <td>Tom</td>
    </tr>
    <tr>
      <th>e</th>
      <td>24</td>
      <td>Lucy</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Jane&#39;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Indexing by label
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>age           20
name        Jane
gender    Female
Name: a, dtype: object
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>a    Jane
c     Tom
e    Lucy
g     Bob
Name: name, dtype: object
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>Jane</td>
      <td>20</td>
    </tr>
    <tr>
      <th>c</th>
      <td>Tom</td>
      <td>24</td>
    </tr>
    <tr>
      <th>e</th>
      <td>Lucy</td>
      <td>24</td>
    </tr>
    <tr>
      <th>g</th>
      <td>Bob</td>
      <td>50</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Jane&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="modifying-dataframes">
<h3>5.1.3 Modifying DataFrames<a class="headerlink" href="#modifying-dataframes" title="Link to this heading">#</a></h3>
<p>We can create new bits of a DataFrame or Series and modify the existing ones.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">age_series</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span>  <span class="c1">#  Select a single column as a series </span>
<span class="n">new_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span> <span class="c1">#   Again notice the extra brackets</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;maths&#39;</span><span class="p">,</span><span class="s1">&#39;biology&#39;</span><span class="p">,</span><span class="s1">&#39;computer science&#39;</span><span class="p">,</span><span class="s1">&#39;physics&#39;</span><span class="p">]</span>    <span class="c1">#   Add a new column. Use list, np.array but length must match original df</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>name</th>
      <th>gender</th>
      <th>subject</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>20</td>
      <td>Jane</td>
      <td>Female</td>
      <td>maths</td>
    </tr>
    <tr>
      <th>c</th>
      <td>24</td>
      <td>Tom</td>
      <td>Male</td>
      <td>biology</td>
    </tr>
    <tr>
      <th>e</th>
      <td>24</td>
      <td>Lucy</td>
      <td>Female</td>
      <td>computer science</td>
    </tr>
    <tr>
      <th>g</th>
      <td>50</td>
      <td>Bob</td>
      <td>Male</td>
      <td>physics</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can also apply conditional filtering of the rows like this</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">names_with_o</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">)]</span>     <span class="c1">#   A Series has a .str property which allows you to operate on all the strings in a column</span>
<span class="n">display</span><span class="p">(</span><span class="n">names_with_o</span><span class="p">)</span>

<span class="n">young_women</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Female&#39;</span><span class="p">)]</span>    <span class="c1">#   We can use any logic to filter. Find Women under 25.</span>
<span class="n">display</span><span class="p">(</span><span class="n">young_women</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>name</th>
      <th>gender</th>
      <th>subject</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>c</th>
      <td>24</td>
      <td>Tom</td>
      <td>Male</td>
      <td>biology</td>
    </tr>
    <tr>
      <th>g</th>
      <td>50</td>
      <td>Bob</td>
      <td>Male</td>
      <td>physics</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>name</th>
      <th>gender</th>
      <th>subject</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>20</td>
      <td>Jane</td>
      <td>Female</td>
      <td>maths</td>
    </tr>
    <tr>
      <th>e</th>
      <td>24</td>
      <td>Lucy</td>
      <td>Female</td>
      <td>computer science</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Since each column is effectively a Numpy array we can also do mathematical and statistical operations on them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>a     80
c     96
e     96
g    200
Name: age, dtype: int64
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>29.5
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="data-input-and-output">
<h2>5.2 Data input and output<a class="headerlink" href="#data-input-and-output" title="Link to this heading">#</a></h2>
<section id="reading-data-from-files">
<h3>5.2.1 Reading Data from Files<a class="headerlink" href="#reading-data-from-files" title="Link to this heading">#</a></h3>
<p>Whilst we can generate Series and Dataframes like this, it is more common to read a large dataset from a file or database. Pandas accepts many formats. For now we will work with csv files, but you could also use Excel, hdf5 (a high density format), sql etc for which there are similar methods. As an example we are going to work with the public Covid-19 dataset from 2019 maintained by John Hopkins University (<a href="https://github.com/owid/covid-19-data/tree/master/public/data">dataset</a>). The file is included in <code class="docutils literal notranslate"><span class="pre">resources</span> <span class="pre">/</span> <span class="pre">textfiles</span> <span class="pre">/</span> <span class="pre">owid-covid-data.csv</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_covid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;resources/textfiles/owid-covid-data.csv&#39;</span><span class="p">)</span> 
<span class="n">df_covid</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>iso_code</th>
      <th>continent</th>
      <th>location</th>
      <th>date</th>
      <th>total_cases</th>
      <th>new_cases</th>
      <th>new_cases_smoothed</th>
      <th>total_deaths</th>
      <th>new_deaths</th>
      <th>new_deaths_smoothed</th>
      <th>...</th>
      <th>male_smokers</th>
      <th>handwashing_facilities</th>
      <th>hospital_beds_per_thousand</th>
      <th>life_expectancy</th>
      <th>human_development_index</th>
      <th>population</th>
      <th>excess_mortality_cumulative_absolute</th>
      <th>excess_mortality_cumulative</th>
      <th>excess_mortality</th>
      <th>excess_mortality_cumulative_per_million</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AFG</td>
      <td>Asia</td>
      <td>Afghanistan</td>
      <td>2020-01-03</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>37.746</td>
      <td>0.5</td>
      <td>64.83</td>
      <td>0.511</td>
      <td>41128772.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AFG</td>
      <td>Asia</td>
      <td>Afghanistan</td>
      <td>2020-01-04</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>37.746</td>
      <td>0.5</td>
      <td>64.83</td>
      <td>0.511</td>
      <td>41128772.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AFG</td>
      <td>Asia</td>
      <td>Afghanistan</td>
      <td>2020-01-05</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>37.746</td>
      <td>0.5</td>
      <td>64.83</td>
      <td>0.511</td>
      <td>41128772.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AFG</td>
      <td>Asia</td>
      <td>Afghanistan</td>
      <td>2020-01-06</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>37.746</td>
      <td>0.5</td>
      <td>64.83</td>
      <td>0.511</td>
      <td>41128772.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AFG</td>
      <td>Asia</td>
      <td>Afghanistan</td>
      <td>2020-01-07</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>37.746</td>
      <td>0.5</td>
      <td>64.83</td>
      <td>0.511</td>
      <td>41128772.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>320267</th>
      <td>ZWE</td>
      <td>Africa</td>
      <td>Zimbabwe</td>
      <td>2023-06-17</td>
      <td>265289.0</td>
      <td>0.0</td>
      <td>18.286</td>
      <td>5702.0</td>
      <td>0.0</td>
      <td>1.000</td>
      <td>...</td>
      <td>30.7</td>
      <td>36.791</td>
      <td>1.7</td>
      <td>61.49</td>
      <td>0.571</td>
      <td>16320539.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>320268</th>
      <td>ZWE</td>
      <td>Africa</td>
      <td>Zimbabwe</td>
      <td>2023-06-18</td>
      <td>265289.0</td>
      <td>0.0</td>
      <td>18.286</td>
      <td>5702.0</td>
      <td>0.0</td>
      <td>1.000</td>
      <td>...</td>
      <td>30.7</td>
      <td>36.791</td>
      <td>1.7</td>
      <td>61.49</td>
      <td>0.571</td>
      <td>16320539.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>320269</th>
      <td>ZWE</td>
      <td>Africa</td>
      <td>Zimbabwe</td>
      <td>2023-06-19</td>
      <td>265413.0</td>
      <td>124.0</td>
      <td>17.714</td>
      <td>5707.0</td>
      <td>5.0</td>
      <td>0.714</td>
      <td>...</td>
      <td>30.7</td>
      <td>36.791</td>
      <td>1.7</td>
      <td>61.49</td>
      <td>0.571</td>
      <td>16320539.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>320270</th>
      <td>ZWE</td>
      <td>Africa</td>
      <td>Zimbabwe</td>
      <td>2023-06-20</td>
      <td>265413.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5707.0</td>
      <td>0.0</td>
      <td>0.714</td>
      <td>...</td>
      <td>30.7</td>
      <td>36.791</td>
      <td>1.7</td>
      <td>61.49</td>
      <td>0.571</td>
      <td>16320539.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>320271</th>
      <td>ZWE</td>
      <td>Africa</td>
      <td>Zimbabwe</td>
      <td>2023-06-21</td>
      <td>265413.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5707.0</td>
      <td>0.0</td>
      <td>0.714</td>
      <td>...</td>
      <td>30.7</td>
      <td>36.791</td>
      <td>1.7</td>
      <td>61.49</td>
      <td>0.571</td>
      <td>16320539.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>320272 rows × 67 columns</p>
</div></div></div>
</div>
<p>Pandas displays the beginning and the end of the dataframe but all the data has been loaded into memory for us to work with.</p>
<p>There are a whole host of options upon reading a file so it is always worth <a href="https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html">looking at the docs</a>. Not all the columns above are of interest. We also want to pick out the data so we might want to set the index to a sensible column. The method <code class="docutils literal notranslate"><span class="pre">df.head(n=numberrows)</span></code> also allows us to look at a small section of the data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_covid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;resources/textfiles/owid-covid-data.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">,</span><span class="s1">&#39;continent&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;total_cases&#39;</span><span class="p">,</span><span class="s1">&#39;new_cases&#39;</span><span class="p">,</span><span class="s1">&#39;total_deaths&#39;</span><span class="p">,</span><span class="s1">&#39;total_cases_per_million&#39;</span><span class="p">,</span><span class="s1">&#39;hospital_beds_per_thousand&#39;</span><span class="p">,</span><span class="s1">&#39;life_expectancy&#39;</span><span class="p">,</span><span class="s1">&#39;population&#39;</span><span class="p">])</span>
<span class="n">df_covid_1stMay</span> <span class="o">=</span> <span class="n">df_covid</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2020-05-01&#39;</span><span class="p">]</span>    <span class="c1">#The dataset contains an entry for every day so lets look at one specific date.</span>
<span class="n">df_covid_1stMay</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>continent</th>
      <th>location</th>
      <th>total_cases</th>
      <th>new_cases</th>
      <th>total_deaths</th>
      <th>total_cases_per_million</th>
      <th>hospital_beds_per_thousand</th>
      <th>life_expectancy</th>
      <th>population</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-05-01</th>
      <td>Asia</td>
      <td>Afghanistan</td>
      <td>1937.0</td>
      <td>110.0</td>
      <td>60.0</td>
      <td>47.096</td>
      <td>0.50</td>
      <td>64.83</td>
      <td>4.112877e+07</td>
    </tr>
    <tr>
      <th>2020-05-01</th>
      <td>NaN</td>
      <td>Africa</td>
      <td>40131.0</td>
      <td>2490.0</td>
      <td>2614.0</td>
      <td>28.128</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.426737e+09</td>
    </tr>
    <tr>
      <th>2020-05-01</th>
      <td>Europe</td>
      <td>Albania</td>
      <td>766.0</td>
      <td>16.0</td>
      <td>30.0</td>
      <td>269.498</td>
      <td>2.89</td>
      <td>78.57</td>
      <td>2.842318e+06</td>
    </tr>
    <tr>
      <th>2020-05-01</th>
      <td>Africa</td>
      <td>Algeria</td>
      <td>4006.0</td>
      <td>158.0</td>
      <td>447.0</td>
      <td>89.214</td>
      <td>1.90</td>
      <td>76.88</td>
      <td>4.490323e+07</td>
    </tr>
    <tr>
      <th>2020-05-01</th>
      <td>Oceania</td>
      <td>American Samoa</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>73.74</td>
      <td>4.429500e+04</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="writing-data-to-files">
<h3>5.2.2 Writing Data to files<a class="headerlink" href="#writing-data-to-files" title="Link to this heading">#</a></h3>
<p>We can also write dataframes to file very easily <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.to_csv.html"> pd.to_csv docs</a>. Similar methods exist to write to other formats.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">df_example</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="n">time</span><span class="p">,</span><span class="s1">&#39;amplitude&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">0.3</span><span class="o">*</span><span class="n">time</span><span class="p">)})</span>
<span class="n">df_example</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;resources/textfiles/write_example.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">df_example</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="n">time</span><span class="p">,</span><span class="s1">&#39;amplitude&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">0.3</span><span class="o">*</span><span class="n">time</span><span class="p">)})</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">df_example</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;resources/textfiles/write_example.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;np&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="returning-vs-inplace">
<h3>5.3.1 Returning vs inplace<a class="headerlink" href="#returning-vs-inplace" title="Link to this heading">#</a></h3>
<p>Many methods have a keyword argument called <code class="docutils literal notranslate"><span class="pre">inplace</span></code>. By default this is usually <code class="docutils literal notranslate"><span class="pre">False</span></code> meaning that the method will return a new DataFrame leaving the original unchanged ie:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    new_df = pd.pandas_method(old_df)
</pre></div>
</div>
<p>However, if you set <code class="docutils literal notranslate"><span class="pre">inplace=True</span></code> this modifies the original DataFrame, so there is no return value. This can be really good for memory and speed, but it comes with the trade off that you’ve changed the original data which you might want for something else.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    pd.pandas_method(df, inplace=True)
</pre></div>
</div>
<p>If you get odd things in your code, where you are finding that you seem to have lost your DataFrame and python is complaining about <code class="docutils literal notranslate"><span class="pre">NoneTypes</span></code> it may be you’ve written something like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    new_df = pd.pandas_method(df, inplace=True)
</pre></div>
</div>
</section>
<section id="data-cleaning">
<h3>5.3.2 Data Cleaning<a class="headerlink" href="#data-cleaning" title="Link to this heading">#</a></h3>
<p>In any realworld dataset the data is usually not perfect and maybe not in the format we want. There may be column data we are not interested in. For this example we’ll pick <code class="docutils literal notranslate"><span class="pre">new_cases</span></code>. We can also see that some of the values are not present and have been filled with NaN. This is the same as <code class="docutils literal notranslate"><span class="pre">np.nan</span></code> we saw before. We have to think carefully about the most appropriate option. There are several options but the decision is yours and depends on your data and task:</p>
<ol class="arabic simple">
<li><p>Leave them:</p></li>
</ol>
<p>NaNs can be helpful because they are not included in calculations of the mean or median of a column and hence don’t skew the results by including 0 or some other value.</p>
<ol class="arabic simple" start="2">
<li><p>Replace them with another value:</p></li>
</ol>
<p>You can replace the NaN values with a substitute value, perhaps 0 or something else appropriate</p>
<ol class="arabic simple" start="3">
<li><p>Remove the row or column where the NaNs appear.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#NB if I try and run this cell more than once it will error as the data has been changed. To rerun I need to rerun the cell above</span>

<span class="c1">#Drop the column &quot;new_cases&quot;</span>
<span class="n">df_covid_1stMay</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;new_cases&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>     <span class="c1">#   Note no return the original df is modified due to inplace=True</span>

<span class="c1">#Replace the NaNs in hospital_beds with 1</span>
<span class="n">df_covid_1stMay</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;hospital_beds_per_thousand&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#   Drop those rows where the column data in either total_cases or life_expectancy contains a NaN.</span>
<span class="n">df_covid_1stMay</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;total_cases&#39;</span><span class="p">,</span><span class="s1">&#39;life_expectancy&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>  

<span class="n">df_covid_1stMay</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="copy-vs-views">
<h3>5.3.3 Copy vs Views<a class="headerlink" href="#copy-vs-views" title="Link to this heading">#</a></h3>
<p>Pandas did what we asked but there were some warnings. What are those about?</p>
<p>When we looked at the python datatype <code class="docutils literal notranslate"><span class="pre">list</span></code> we saw that if one list was equal to the other, then changes to one list affected the other. In Pandas there is a slightly complicated subtelty. Sometimes Pandas returns a <em>copy</em> (ie an independent set of data) and sometimes a <em>View</em>. A <em>View</em> is similar to the effect we saw with lists in that it accesses the same data and hence changes in the <em>View</em> will also affect the original. See the example below. It’s not always obvious, when Pandas does which but it’s something to be aware of if you get odd things happening. <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy">See this discussion</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">other_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;age&#39;</span><span class="p">:[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span><span class="s1">&#39;name&#39;</span><span class="p">:[</span><span class="s1">&#39;Jane&#39;</span><span class="p">,</span><span class="s1">&#39;Tom&#39;</span><span class="p">,</span><span class="s1">&#39;Lucy&#39;</span><span class="p">,</span><span class="s1">&#39;Bob&#39;</span><span class="p">],</span> <span class="s1">&#39;gender&#39;</span><span class="p">:[</span><span class="s1">&#39;Female&#39;</span><span class="p">,</span> <span class="s1">&#39;Male&#39;</span><span class="p">,</span><span class="s1">&#39;Female&#39;</span><span class="p">,</span> <span class="s1">&#39;Male&#39;</span><span class="p">]}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">other_data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">])</span>   <span class="c1"># You&#39;ll see that people often write the dataframe variable as df. </span>

<span class="n">view</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
<span class="n">view</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Martha&#39;</span> <span class="c1">#   Change a value on the Series view but it alters the original DataFrame.</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="aggregation-and-grouping">
<h2>5.4 Aggregation and grouping<a class="headerlink" href="#aggregation-and-grouping" title="Link to this heading">#</a></h2>
<p>Often we want to group our data and work out the properties on those datasets. For example, returning to the Covid dataset, let’s group the countries together by continent. We will then work out for each continent the max, min and average life expectancy.</p>
<p><a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.groupby.html">pandas groupby</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Create a groupby object</span>
<span class="n">continent_groupby</span> <span class="o">=</span> <span class="n">df_covid</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;continent&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">continent_groupby</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>  <span class="c1">#   Display the categories</span>

<span class="c1">#For each group of countries calculate the max, min and mean life expectancy</span>
<span class="n">display</span><span class="p">(</span><span class="n">continent_groupby</span><span class="p">[</span><span class="s1">&#39;life_expectancy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">display</span><span class="p">(</span><span class="n">continent_groupby</span><span class="p">[</span><span class="s1">&#39;life_expectancy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">display</span><span class="p">(</span><span class="n">continent_groupby</span><span class="p">[</span><span class="s1">&#39;life_expectancy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="timeseries-data">
<h2>5.5 TimeSeries Data<a class="headerlink" href="#timeseries-data" title="Link to this heading">#</a></h2>
<p>Another common class of tasks are operations on data that forms a sequential sequence. Often this is data that varies over time. For example, we might want to calculate the running average on some noisy data as a way of trying to smooth it. Our original covid dataset contains the number of new cases every day, for each country. We might expect that the fluctuations from day to day would make this data less useful than a weekly figure. Lets try and calculate the number of new cases in the UK summed over each week. To do that we will take the 7 day rolling average.</p>
<p><a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.rolling.html">pandas rolling</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Extract data for the UK</span>
<span class="n">df_uk</span> <span class="o">=</span> <span class="n">df_covid</span><span class="p">[</span><span class="n">df_covid</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;United Kingdom&#39;</span><span class="p">]</span>
<span class="n">df_weekly</span><span class="o">=</span><span class="n">df_uk</span><span class="p">[</span><span class="s1">&#39;new_cases&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_weekly</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2023-05-01&#39;</span><span class="p">:</span><span class="s1">&#39;2023-05-10&#39;</span><span class="p">])</span>    <span class="c1">#   Note using slicing on row label indices beacuse they are sequential indices.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#We can then see the effect of the smoothing</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">7</span><span class="o">*</span><span class="n">df_uk</span><span class="p">[</span><span class="s1">&#39;new_cases&#39;</span><span class="p">],</span><span class="s1">&#39;r-&#39;</span><span class="p">)</span>  <span class="c1"># Original data scaled to compare, Note you can send a Series directly to Matplotlib</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_weekly</span><span class="p">,</span><span class="s1">&#39;b-&#39;</span><span class="p">)</span> <span class="c1"># We can supply a Series directly to maplotlib. It uses index as x values.</span>

<span class="n">xticks</span> <span class="o">=</span> <span class="n">df_weekly</span><span class="o">.</span><span class="n">index</span><span class="p">[::</span><span class="mi">300</span><span class="p">]</span> <span class="c1">#   Bit of slicing to generate smaller number of labels for x axis</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Total New Cases&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;New Covid Cases UK&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="joining-dataframes">
<h2>5.6 Joining DataFrames<a class="headerlink" href="#joining-dataframes" title="Link to this heading">#</a></h2>
<p>There are various different ways to join dataframes together. <a href="https://pandas.pydata.org/docs/user_guide/merging.html">Pandas docs</a> here cover this topic in a lot of detail. Some of the diagrams I’ve used are taken from there.  There are 2 main different ways to do this:</p>
<section id="concatenation">
<h3>5.6.1 Concatenation<a class="headerlink" href="#concatenation" title="Link to this heading">#</a></h3>
<p>Concatenation joins DataFrames “vertically”. The diagram below shows how we might join 3 dataframes df1, df2 and df3 of the same width and same columns.</p>
<div> <img src="resources/images/concatenation.png" alt="Drawing" style="width: 400px;"/></div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A simplified example of the above.</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="s1">&#39;B&#39;</span><span class="p">:[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span><span class="s1">&#39;C&#39;</span><span class="p">:[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span><span class="s1">&#39;B&#39;</span><span class="p">:[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span><span class="s1">&#39;C&#39;</span><span class="p">:[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">]},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>

<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">]))</span>       <span class="c1">#   Sometimes the values in the index will clash. Sometimes you want this - The index info is important.</span>
<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>        <span class="c1"># Sometimes you don&#39;t - You want each value to have its own reference.</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="merging">
<h3>5.6.2 Merging<a class="headerlink" href="#merging" title="Link to this heading">#</a></h3>
<p>There are many different options for joining DataFrames. A merge is often used to join DataFrames horizontally. This can be really helpful if you have two datasources which contain related information. By merging them we can easily work out how the data is related.</p>
<p>If DataFrames have a common index or column, you can use this to join them. They don’t have to have the same number of rows. Pandas will use the rows that are the same and produce NaNs in positions where values don’t exist. You can also join on multiple columns. Here things get a bit messy. You can use the values in the joining column or columns retaining the rows in either the left dataframe or the right dataframe, the common values (‘inner’) or all values (‘outer’).</p>
<p>Perhaps easiest to see this as an example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A simplified example of the above.</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Name&#39;</span><span class="p">:[</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span><span class="s1">&#39;Mike&#39;</span><span class="p">,</span><span class="s1">&#39;Jane&#39;</span><span class="p">],</span><span class="s1">&#39;Subject&#39;</span><span class="p">:[</span><span class="s1">&#39;Physics&#39;</span><span class="p">,</span><span class="s1">&#39;Maths&#39;</span><span class="p">,</span><span class="s1">&#39;Chemistry&#39;</span><span class="p">]},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Name&#39;</span><span class="p">:[</span><span class="s1">&#39;Mike&#39;</span><span class="p">,</span><span class="s1">&#39;Jane&#39;</span><span class="p">,</span><span class="s1">&#39;Luke&#39;</span><span class="p">],</span><span class="s1">&#39;Year&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">display</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;merge results&#39;</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">))</span>    <span class="c1"># Only keep the rows where the Name exists in df1</span>
<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">))</span>   <span class="c1"># Only keep the rows where the Name exists in df2</span>
<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">))</span>   <span class="c1"># Only keep the rows where the Name exists in both df1 and df2</span>
<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">))</span>    <span class="c1"># keep all the rows</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="speeding-things-up-in-pandas">
<h2>5.7 Speeding things up in Pandas<a class="headerlink" href="#speeding-things-up-in-pandas" title="Link to this heading">#</a></h2>
<p>There are several simple things that you can do to make your Pandas code run faster:</p>
<ol class="arabic simple">
<li><p>Just as with Numpy, you should avoid writing code that performs an operation on a DataFrame by running a for loop on each row sequentially. The in-built Pandas functions will be much faster than using python code.</p></li>
<li><p>Where possible use the <code class="docutils literal notranslate"><span class="pre">inplace=True</span></code> as a keyword argument to functions. This modifies the original data but generally runs faster.</p></li>
<li><p>Use the index to access rows rather than boolean selection (see example below).</p></li>
<li><p>The order of the index can make a huge difference. Sorting it into order and then using the index to access data can result in huge speed ups. The example below shows that once sorted there is a speed up from about 25ms to 200μs!</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Working with the df_uk frame</span>
<span class="n">df_uk</span> <span class="o">=</span> <span class="n">df_covid</span><span class="p">[</span><span class="n">df_covid</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;United Kingdom&#39;</span><span class="p">]</span>
<span class="n">df_uk</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>it    #   This example uses .loc which is quicker (a bit) than the next cell where we access the same thing using boolean indexing
<span class="n">df_uk</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2022-06-01&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>it
<span class="n">df_uk</span><span class="p">[</span><span class="n">df_uk</span><span class="o">.</span><span class="n">index</span><span class="o">==</span><span class="s1">&#39;2022-06-01&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>it
<span class="c1"># However there is a big difference if we sort the index. The first example does the same as above, using the full df_covid dataset. Here, the index of the dataframe is sorted by the location and then by the index date and is pretty slow.</span>
<span class="n">df_covid</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2021-05-03&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>it
<span class="c1"># Sorting the dataframe takes a long time but if we want to run the operations on the sorted dataframe multiple times, it is better to sort it once and then use it.</span>
<span class="n">df_covid2</span> <span class="o">=</span> <span class="n">df_covid</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_covid2</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>it
<span class="c1"># Now the dataframe is sorted the .loc operation is really fast.</span>
<span class="n">df_covid2</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2021-05-03&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content\E5"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../E4/T4.%20scipyetc.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">4. Exploring Scipy and other python packages</p>
      </div>
    </a>
    <a class="right-next"
       href="../E7/T7.%20OOP_python.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">7 Object Oriented Programming</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#series-and-dataframes">5.1 Series and Dataframes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-series-and-dataframes">5.1.1 Creating Series and DataFrames</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selecting-data-in-a-dataframe">5.1.2 Selecting Data in a DataFrame</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modifying-dataframes">5.1.3 Modifying DataFrames</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-input-and-output">5.2 Data input and output</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-data-from-files">5.2.1 Reading Data from Files</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#writing-data-to-files">5.2.2 Writing Data to files</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#returning-vs-inplace">5.3.1 Returning vs inplace</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-cleaning">5.3.2 Data Cleaning</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#copy-vs-views">5.3.3 Copy vs Views</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aggregation-and-grouping">5.4 Aggregation and grouping</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#timeseries-data">5.5 TimeSeries Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#joining-dataframes">5.6 Joining DataFrames</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#concatenation">5.6.1 Concatenation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#merging">5.6.2 Merging</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#speeding-things-up-in-pandas">5.7 Speeding things up in Pandas</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dr Mike Smith
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>